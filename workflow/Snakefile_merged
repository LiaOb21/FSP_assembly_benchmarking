# Main entrypoint of the workflow when using merged reads and not R1 & R2.
# Please follow the best practices:
# https://snakemake.readthedocs.io/en/stable/snakefiles/best_practices.html,
# in particular regarding the standardized folder structure mentioned there.

import glob
import os


configfile: "config/config.yml"


input_dir = config["input_dir"]
output_dir = config["output_dir"]

# Collect sample names from test_data directory
SAMPLES = [os.path.basename(d) for d in glob.glob(f"{input_dir}/*") if os.path.isdir(d)]

# Define assembler names
ASSEMBLERS = ["spades", "megahit", "abyss", "sparseassembler", "minia", "masurca"]


rule all:
    input:
        #        expand(f"{output_dir}" + "/{sample}/spades/scaffolds.fasta", sample=SAMPLES),
        #        expand(f"{output_dir}" + "/{sample}/megahit/", sample=SAMPLES),
        #        expand(f"{output_dir}" + "/{sample}/abyss/abyss-scaffolds.fa", sample=SAMPLES),
        #        expand(f"{output_dir}" + "/{sample}/sparseassembler/SuperContigs.txt", sample=SAMPLES),
        #        expand(f"{output_dir}" + "/{sample}/minia/{sample}.contigs.fa", sample=SAMPLES),
        #        expand(f"{output_dir}" + "/{sample}/masurca/masurca_config.txt", sample=SAMPLES),
        #        expand(f"{output_dir}" + "/{sample}/masurca/CA/primary.genome.scf.fasta", sample=SAMPLES),
        #        # busco output
        expand(
            f"{output_dir}" + "/{sample}/busco/{assembler}",
            sample=SAMPLES,
            assembler=ASSEMBLERS,
        ),
        expand(f"{output_dir}" + "/{sample}/quast", sample=SAMPLES),


# include spades rules
include: "rules/spades_merged.smk"
# include megahit rule
include: "rules/megahit_merged.smk"
# include abyss rule
include: "rules/abyss_merged.smk"
# include decompress_reads rule
include: "rules/decompress_reads_merged.smk"
# include sparseassembler rule
include: "rules/sparseassembler_merged.smk"
# include minia rule
include: "rules/minia_merged.smk"
# include masurca_config rule
include: "rules/masurca_config_merged.smk"
# include masurca rule
include: "rules/masurca_merged.smk"
# include busco rule
include: "rules/busco_merged.smk"
# include quast rule
include: "rules/quast_merged.smk"


# print("SAMPLES:", SAMPLES)
